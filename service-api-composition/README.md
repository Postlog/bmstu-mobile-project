### service-api-composition

Сервис состоит из двух частей: сервер HTTP-запросов и обработчика задач на увеличение изображения

### HTTP-сервер

В сервисе есть 4 ручки.

```
GET /image/{imageId}
```

Ручка позволяет получить изображение по его ID

Ответы:

- `200 OK` - в теле ответа содержатся бинарные данные изображения в формате PNG
- `404 Not Found` - изображения с указанным ID не существует
- `500 Internal Server Error` - внутренняя ошибка

---

```
POST /image
```

Позволяет сохранить изображение в формате PNG

Тело запроса должно содержать бинарные данные изображения

Ответы:

_Во всех случаях ответ отправляется со статусом `200 OK`_

* Изображение успешно сохранено, ему присвоен ID:

```json
{
  "imageId": "<image_id>"
}
```

* Ошибки:

```json
{
  "error": {
    "code": 400,
    "message": "Тело запроса некорректно"
  }
}
```

```json
{
  "error": {
    "code": 400,
    "message": "Изображение слишком большое"
  }
}
```

```json
{
  "error": {
    "code": 400,
    "message": "Изображение должно быть в формате PNG"
  }
}
```

```json
{
  "error": {
    "code": 500,
    "message": "Непредвиденная ошибка, попробуйте позже"
  }
}
```

---

```
GET /task/scale/{taskId}
```

Ручка позволяет получить результат выполнения задачи на увеличение
изображения по ID задачи

Ответы:

```json
{
  "result": {
    "taskId": "<task_id>",
    "originalImageId": "<image_id>",
    "scaleFactor": 3,
    "imageId": "<image_id>",
    "scaleError": null
  }
}
```

* Ошибки:

```json
{
  "error": {
    "code": 404,
    "message": "Результат не найден"
  }
}
```

```json
{
  "error": {
    "code": 500,
    "message": "Непредвиденная ошибка, попробуйте позже"
  }
}
```

```
POST /task/scale
```

Ручка позволяет получить создать задачу на увеличение
изображения

Тело запроса - JSON вида:

```json
{
  "imageId": "<image_id>",
  "scaleFactor": 3
}
```

Ответы:

```json
{
  "taskId": "<task_id>"
}
```

* Ошибки:

```json
{
  "error": {
    "code": 400,
    "message": "Коэффициент масштабирования некорректен"
  }
}
```

```json
{
  "error": {
    "code": 400,
    "message": "Тело запроса должно быть в формате JSON"
  }
}
```

```json
{
  "error": {
    "code": 500,
    "message": "Непредвиденная ошибка, попробуйте позже"
  }
}
```

### Обработчик задач на увеличение изображения

Ручка `POST /task/scale` создает задачу и публикует ее в RabbitMQ. 
Обработчик читает задачи из Rabbit'а и отправляет запрос
на увеличение в сервис `image-scaler`. Результат обработки
сохраняет в базу данных
